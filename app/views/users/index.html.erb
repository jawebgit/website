<% provide(:title , "User Management")%>

<div class="row">
	<div class="span12">
		<h2>
			User Management
			<div class="btn-group pull-right">
				<%= link_to("Edit Positions" , position_management_path , :class => "btn")%>
				<a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
					Action
					<span class="caret"></span>
				</a>
				<ul class="dropdown-menu">
					<li><%= link_to "User" , "#{users_path}/new"%></li>
					<li><%= link_to "Pledge Class" , "#{users_path}"%></li>
				</ul>
			</div>
		</h2>
		<div class="row">
			<div class="span12">
			  <% unless @affiliates.empty?%>
				<h3>Affiliates</h3>
				<table class="table table-striped table-hover table-condensed">
					<thead><tr>
						<th>Username</th>
						<th>Primary Group</th>
						<th>Mit Student</th>
						<th>Actions</th>
					</tr></thead>
					<tbody>
					  <% @affiliates.each do | usr |%>
					  <tr>
						<td><%= usr%></td>
					  	<td><%= Apache.groups(usr)[0]%></td>
					  	<td><%= Users.new(usr).student?%></td>
					  	<td>
					  		<%= link_to("Edit" , "#{users_path}/#{usr}" , :class => "btn")%>
					  		<%= link_to("Delete" , "#{users_path}/#{usr}" , method: :delete, data: { confirm: "Are you sure you would like to delete #{usr}?" }, :class => "btn")%>
					  	</td>
					  </tr>
					  <%end%>
					</tbody>
				</table>
			  <%end%>	
				<h3>Brothers</h3>
				<table class="table table-striped table-hover table-condensed">
				  <% @brothers.each do | year , group |%>
					<thead><tr>
						<th style="font-size:20px;">Class of <%= year %></th>
						<th>Username</th>
						<th>Primary Group</th>
						<th>MIT Class</th>
						<th>Admin</th>
						<th>Actions</th>
					</tr></thead>
					<tbody>
					  <% group.each do | name , uname |%>
					    <% @user = Users.new(uname)%>
					  	<tr>
					  		<td><%= name%></td>
					  		<td><%= uname%></td>
					  		<td><%= Apache.groups(uname)[0]%></td>
					  		<td><%= @user.mit.year%></td>
					  		<td><%= @user.admin?%></td>
					  		<td>
					  		  <%= form_tag "#{users_path}/#{uname}#update", method: :patch, class: "no-padding" do%>
					  			<%= link_to("Edit" , "#{users_path}/#{uname}" , :class => "btn")%>
					  			<%= link_to("Delete" , "#{users_path}/#{uname}" , method: :delete, data: { confirm: "Are you sure you would like to delete #{uname} from all databases?" }, :class => "btn")%>
					  			<% if Apache.exists(uname)%>
					  				<%= link_to("Remove Access" , "#{users_path}/#{uname}#update", method: :patch, data: { confirm: "Are you sure you would like remove server access for #{uname}?" }, :class => "btn")%>
					  			<%else%>
					  				<%= submit_tag("Give Access",  :class => "btn")%>
					  				<%= password_field_tag :password, nil , :class => "pswd-field" unless @user.student?%>
					  			<%end%>
					  		  <%end%>
					  		</td>
					  	</tr>
					  <%end%>
					</tbody>
				  <%end%>
				</table>
			</div>
		</div>
	</div>
</div>
